# zai 技术指南
版本：1.2

[English](DOCUMENTATION.md) | [中文](DOCUMENTATION.zh-CN.md)

## 简介

**zai** 是一种专为现代 AI 工作流构建的编程语言。它将状态管理（Context）和 AI 个性（Persona）作为一等公民优先考虑。
它旨在提供一个原生的、统一的框架，用于构建状态、逻辑和推理深度集成的复杂 AI 智能体。

## 2. 核心架构：三位一体模型

zai 管理三个主要实体之间的交互：

1.  **人类**：通过 `ask` 和 `say` 提供指令和接收反馈的终端用户。
2.  **AI（大语言模型）**：处理上下文并通过 `process` 提取结构化数据的推理引擎。
3.  **技能（代码）**：用 zai 编写的编排逻辑，控制流程并通过 `exec` 集成**外部系统**。

### 面向上下文的设计

在 zai 中，**上下文为王**。
- **上下文（状态）**：智能体知道什么。
- **人格（声音）**：智能体如何与 AI 对话。
- **技能（行为）**：智能体做什么。
- **Agent 系统提示词**：智能体的基础身份。

### Agent 系统提示词

可以使用 `<<< ... >>>` 语法在智能体级别定义可选的基础系统提示词。这建立了智能体的基础身份，并始终包含在 AI 交互中。

```zai
agent CustomerServiceBot
<<<
你是一位专业的客户服务代表。
当前客户：{{customer_name}}
请始终保持礼貌和乐于助人。
>>>

context CustomerContext {
    customer_name: "访客"
}

skill HandleInquiry() {
    ask "请问您叫什么名字？{{customer_name=}}"
    process "有什么可以帮您的？" { extract: ["response"] }
}
```

`process` 期间的系统提示词组合顺序：
1. **Agent 级系统提示词**（基础身份，模板在运行时解析）
2. **活跃的 persona 覆盖层**（情境调整）

## 3. 语言特性

### 动态模板
字符串支持使用 `{{variable}}` 语法进行模板渲染。上下文变量和局部变量会自动插值。

```zai
var Welcome = "你好 {{user_name}}！"
var Page = "{{header}} 内容在这里。"
context.user_name = "Riven"
context.header = Welcome
say Page  // 输出：你好 Riven！内容在这里。
```

### 上下文感知 AI 交互
`process` 命令是语言的"大脑"。它不仅调用 LLM，还将整个上下文状态与 AI 同步，实现精确的数据提取和状态转换。

### 同步外部集成
zai 的 `exec` 原语是同步和阻塞的。它将外部系统（API/Shell）视为状态机的可靠扩展。

### 分布式协调
多个 zai `agent` 可以协同工作。使用 `notify` 和 `wait`，您可以构建一个 swarm 的专业智能体，使用标准化通信协议 `[code, message]` 协作完成复杂任务。

## 4. zai 智能体的生命周期

1.  **启动**：解释器加载 `.zai` 文件。
2.  **初始化**：实例化 `context`。
3.  **调用**：调用 `skill`（通常是入口技能）。
4.  **执行**：技能运行，与 AI、人类和外部系统交互。
5.  **标准化终止**：技能返回 `success` 或 `fail`，智能体状态被持久化或通过 `notify` 传递给下一个智能体。

---

## 5. 愿景

zai 消除了"胶水代码"问题。通过将上下文作为语言的一等构造，它消除了复杂协议和零散工具定义的需求。zai 文件是 AI 行为的自文档化、可执行蓝图。
